#!/bin/bash
clear
################################################################################
#   This script removes all snaps from Ubuntu Mate
################################################################################

################################################################################
#   Define Variables
################################################################################
# Static Variables
origdir=`pwd`

# Dynamic Variables
now=$(date +'%m/%d/%Y %r')

################################################################################
#   Define Functions
################################################################################
timestamp()
{
    now=$(date +'%m/%d/%Y %r')
}

check_exit_status() 
{

    if [ $? -eq 0 ]
    then
        echo
        echo "Success"
        echo
    else
        echo
        echo "[ERROR] Process Failed!"
        echo
		
        read -p "The last command exited with an error. Exit script? (y/n) " ans

        if [ "$ans" == "y" ]
        then
            exit 1
        fi
    fi
}

################################################################################
#   Main Processing
################################################################################
timestamp

echo "##########################################################################"
echo "# Setup process started by $USER on $now"
echo "##########################################################################"
echo

#-------------------------------------------------------------------------------
#   Make sure base system is up to date first.
#-------------------------------------------------------------------------------
echo "--------------------------------------------------------------------------"
echo "- APT update"    
echo "--------------------------------------------------------------------------"
echo

sudo apt update;
check_exit_status;

echo "--------------------------------------------------------------------------"
echo "- APT upgrade"    
echo "--------------------------------------------------------------------------"
echo

sudo apt upgrade -y;
check_exit_status;

#-------------------------------------------------------------------------------
#   list Snaps
#-------------------------------------------------------------------------------
echo "--------------------------------------------------------------------------"
echo "- List Snaps"    
echo "--------------------------------------------------------------------------"
echo
snap list;
echo
#-------------------------------------------------------------------------------
#   Remove Existing Snaps
#-------------------------------------------------------------------------------
echo "--------------------------------------------------------------------------"
echo "- Remove ubuntu-mate-welcome"    
echo "--------------------------------------------------------------------------"
echo

sudo snap remove ubuntu-mate-welcome;
echo

echo "--------------------------------------------------------------------------"
echo "- Remove software-boutique"    
echo "--------------------------------------------------------------------------"
echo

sudo snap remove software-boutique;
echo

echo "--------------------------------------------------------------------------"
echo "- Remove core18"    
echo "--------------------------------------------------------------------------"
echo

sudo snap remove core18;
echo

echo "--------------------------------------------------------------------------"
echo "- List Snaps"    
echo "--------------------------------------------------------------------------"
echo
snap list;
echo

#-------------------------------------------------------------------------------
#   Remove SnapD
#-------------------------------------------------------------------------------
echo "--------------------------------------------------------------------------"
echo "- Purge snapd"    
echo "--------------------------------------------------------------------------"
echo

sudo rm -rf /var/cache/snapd;
sudo apt purge snapd -y;
echo

echo "--------------------------------------------------------------------------"
echo "- Remove snap directory from home"    
echo "--------------------------------------------------------------------------"
echo
rm -rf ~/snap;

echo "--------------------------------------------------------------------------"
echo "- List Snaps"    
echo "--------------------------------------------------------------------------"
echo
snap list;
echo

#-------------------------------------------------------------------------------
#   Cleanup
#-------------------------------------------------------------------------------
echo "--------------------------------------------------------------------------"
echo "- APT autoremove"    
echo "--------------------------------------------------------------------------"
echo

sudo apt autoremove --purge -y;
check_exit_status

echo "--------------------------------------------------------------------------"
echo "- APT clean"    
echo "--------------------------------------------------------------------------"
echo

sudo du -sh /var/cache/apt/archives
echo
sudo apt autoclean -y;
sudo apt clean;
echo
sudo du -sh /var/cache/apt/archives
echo

check_exit_status

timestamp

echo "##########################################################################"
echo "# Setup process ended by $USER on $now"
echo "##########################################################################"
echo
